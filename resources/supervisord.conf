[supervisord]
nodaemon=true
logfile=/home/frappe/frappe-bench/logs/supervisord.log
pidfile=/home/frappe/frappe-bench/logs/supervisord.pid
childlogdir=/home/frappe/frappe-bench/logs

##############################
# Initialization programs
##############################

[program:configurator]
command=/bin/bash /home/frappe/frappe-bench/scripts/configurator.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=false
startsecs=0
startretries=1
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/configurator.log
stderr_logfile=/home/frappe/frappe-bench/logs/configurator.err

environment=DB_HOST="%(ENV_DB_HOST)s",DB_PORT="%(ENV_DB_PORT)s",DB_USER="%(ENV_DB_USER)s",DB_PASSWORD="%(ENV_DB_PASSWORD)s",DB_NAME="%(ENV_DB_NAME)s",SOCKETIO_PORT="%(ENV_SOCKETIO_PORT)s"

[program:create-site]
command=/bin/bash /home/frappe/frappe-bench/scripts/create-site.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=false
startsecs=0
startretries=1
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/create-site.log
stderr_logfile=/home/frappe/frappe-bench/logs/create-site.err
; Environment variables for the script
environment=DB_HOST="%(ENV_DB_HOST)s",DB_PORT="%(ENV_DB_PORT)s",DB_USER="%(ENV_DB_USER)s",DB_PASSWORD="%(ENV_DB_PASSWORD)s",DB_NAME="%(ENV_DB_NAME)s",ADMIN_PASSWORD="%(ENV_ADMIN_PASSWORD)s"

##############################
# Core services
##############################

[program:backend]
command=/bin/bash /home/frappe/frappe-bench/scripts/backend.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=true
startsecs=5
startretries=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/backend.log
stderr_logfile=/home/frappe/frappe-bench/logs/backend.err
# Wait for site to be ready

[program:frontend]
command=/usr/local/bin/nginx-entrypoint.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=true
startsecs=5
startretries=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/nginx.log
stderr_logfile=/home/frappe/frappe-bench/logs/nginx.err

environment=BACKEND="%(ENV_BACKEND)s",FRAPPE_SITE_NAME_HEADER="%(ENV_FRAPPE_SITE_NAME_HEADER)s",SOCKETIO="%(ENV_SOCKETIO)s",UPSTREAM_REAL_IP_ADDRESS="%(ENV_UPSTREAM_REAL_IP_ADDRESS)s",UPSTREAM_REAL_IP_HEADER="%(ENV_UPSTREAM_REAL_IP_HEADER)s",UPSTREAM_REAL_IP_RECURSIVE="%(ENV_UPSTREAM_REAL_IP_RECURSIVE)s",PROXY_READ_TIMEOUT="%(ENV_PROXY_READ_TIMEOUT)s",CLIENT_MAX_BODY_SIZE="%(ENV_CLIENT_MAX_BODY_SIZE)s"

##############################
# Workers
##############################

[program:queue-long]
command=/bin/bash /home/frappe/frappe-bench/scripts/queue-long.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=true
startsecs=5
startretries=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/queue-long.log
stderr_logfile=/home/frappe/frappe-bench/logs/queue-long.err

[program:queue-short]
command=/bin/bash /home/frappe/frappe-bench/scripts/queue-short.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=true
startsecs=5
startretries=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/queue-short.log
stderr_logfile=/home/frappe/frappe-bench/logs/queue-short.err

[program:scheduler]
command=/bin/bash /home/frappe/frappe-bench/scripts/scheduler.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=true
startsecs=5
startretries=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/scheduler.log
stderr_logfile=/home/frappe/frappe-bench/logs/scheduler.err

[program:websocket]
command=node /home/frappe/frappe-bench/apps/frappe/socketio.js
directory=/home/frappe/frappe-bench
autostart=true
autorestart=true
startsecs=5
startretries=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/websocket.log
stderr_logfile=/home/frappe/frappe-bench/logs/websocket.err

[program:qb_connector]
command=/bin/bash /home/frappe/frappe-bench/scripts/qb_connector.sh
directory=/home/frappe/frappe-bench
autostart=true
autorestart=true
startsecs=5
startretries=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/qb_connector.log
stderr_logfile=/home/frappe/frappe-bench/logs/qb_connector.err

environment=PORT="%(ENV_PORT)s",FRAPPE_API_TOKEN="%(ENV_FRAPPE_API_TOKEN)s",FRAPPE_SITE_URL="%(ENV_FRAPPE_SITE_URL)s",QBO_ENV="%(ENV_QBO_ENV)s",TAXED_DISCOUNT_ID="%(ENV_TAXED_DISCOUNT_ID)s",NON_TAXED_DISCOUNT_ID="%(ENV_NON_TAXED_DISCOUNT_ID)s",SALES_TAX_ID="%(ENV_SALES_TAX_ID)s",SALES_TAX_STATE="%(ENV_SALES_TAX_STATE)s",DISCOUNT_ID="%(ENV_DISCOUNT_ID)s",QBO_DEPOSIT_ACCOUNT_NAME="%(ENV_QBO_DEPOSIT_ACCOUNT_NAME)s"

[program:redis]
command=/usr/bin/redis-server --port 6379 --protected-mode no
autostart=true
autorestart=true
startsecs=5
user=frappe
stdout_logfile=/home/frappe/frappe-bench/logs/redis.log
stderr_logfile=/home/frappe/frappe-bench/logs/redis.err
